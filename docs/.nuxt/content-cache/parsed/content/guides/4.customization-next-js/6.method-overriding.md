{"parsed":{"_path":"/guides/customization-next-js/method-overriding","_dir":"customization-next-js","_draft":false,"_partial":false,"_locale":"","title":"Calling custom endpoints","description":"Alokai Middleware is called an orchestration layer - it's responsible for combining data from different sources and\npresenting it to the front end in a simple form. In this chapter, we will tackle a common business case - fetching reviews\nfrom an external system. It is a common scenario that product reviews are managed by a dedicated service rather than the\neCommerce platform.","layout":"default","navigation":{"icon":"tabler:number-5-small"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"overriding-api-methods-getting-product-reviews-from-an-external-source"},"children":[{"type":"text","value":"Overriding API methods / Getting product reviews from an external source"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Alokai Middleware is called an orchestration layer - it's responsible for combining data from different sources and\npresenting it to the front end in a simple form. In this chapter, we will tackle a common business case - fetching reviews\nfrom an external system. It is a common scenario that product reviews are managed by a dedicated service rather than the\neCommerce platform."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Thanks to the Unified Data Model we won't need to touch the front end at all to implement this."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Open "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"apps/storefront-middleware/integrations/sapcc/extensions/unified.ts"}]},{"type":"text","value":" and add this code:"}]}]},{"type":"element","tag":"pre","props":{"className":"language-diff shiki shiki-themes one-dark-pro","code":"+ interface DummyReview {\n+   rating: number;\n+   comment: string;\n+   date: string;\n+   reviewerName: string;\n+   reviewerEmail: string;\n+ }\n+ interface DummyProduct {\n+   reviews: DummyReview[];\n+ }\n\n// ...\n\nexport const unifiedApiExtension = createUnifiedExtension({\n\n // ...\n\n+  methods: {\n+    override: {\n+      getProductReviews: async (context, args) => {\n+        const product: DummyProduct = await (\n+          await fetch(`https://dummyjson.com/products/${args.productId.slice(0, 2)}`)\n+        ).json();\n+        const reviews: SfProductReview[] = product.reviews.map((review) => ({\n+          id: crypto.randomUUID().toString(),\n+          createdAt: review.date,\n+          rating: review.rating,\n+          reviewer: review.reviewerName,\n+          text: review.comment,\n+          title: review.comment.slice(0, 10),\n+        }));\n+        return {\n+          pagination: {\n+            currentPage: 1,\n+            pageSize: reviews.length,\n+            totalPages: 1,\n+            totalResults: reviews.length,\n+          },\n+          reviews: reviews,\n+        };\n+      },\n+    },\n+  },\n","filename":"apps/storefront-middleware/integrations/sapcc/extensions/unified.ts","language":"diff","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+ interface DummyReview {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+   rating: number;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+   comment: string;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+   date: string;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+   reviewerName: string;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+   reviewerEmail: string;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+ }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+ interface DummyProduct {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+   reviews: DummyReview[];\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+ }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"export const unifiedApiExtension = createUnifiedExtension({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" // ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+  methods: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+    override: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+      getProductReviews: async (context, args) => {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+        const product: DummyProduct = await (\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          await fetch(`https://dummyjson.com/products/${args.productId.slice(0, 2)}`)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+        ).json();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+        const reviews: SfProductReview[] = product.reviews.map((review) => ({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          id: crypto.randomUUID().toString(),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          createdAt: review.date,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          rating: review.rating,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          reviewer: review.reviewerName,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          text: review.comment,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          title: review.comment.slice(0, 10),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+        }));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+        return {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          pagination: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+            currentPage: 1,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+            pageSize: reviews.length,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+            totalPages: 1,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+            totalResults: reviews.length,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+          reviews: reviews,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+        };\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+      },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"+  },\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What we do here is overwrite the OOTB "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"getProductReviews"}]},{"type":"text","value":" that by default fetches reviews from the eCommerce platform.\nWe used "},{"type":"element","tag":"a","props":{"href":"https://dummyjson.com","rel":["nofollow"]},"children":[{"type":"text","value":"DummyJSON API"}]},{"type":"text","value":" to fetch some random product data and extract reviews from it. Imagine that it could be any review\nservice. Then we transform the proprietary data model into the Unified Data Model."}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Open a product page and expand \"Customer Reviews\". You should see some random reviews now."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Product reviews","src":"/guides/4.customization-next-js/images/reviews.webp","style":{"aspectRatio":"2418/1206"}},"children":[]}]},{"type":"element","tag":"ol","props":{"start":3},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"To make our code more scalable we can extract the new method from the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"unified.ts"}]},{"type":"text","value":" file with the help of the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineApi"}]},{"type":"text","value":"\nfunction."}]}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes one-dark-pro","code":"const getProductReviews = defineApi.getProductReviews(async (context, args) => {\n  // function body\n});\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" getProductReviews"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" defineApi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"getProductReviews"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // function body\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"});\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can find a complete project example in this repository: "},{"type":"element","tag":"a","props":{"href":"https://github.com/vsf-customer/extensibility-demo","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/vsf-customer/extensibility-demo"}]},{"type":"text","value":"\nIf you want to get access to it, contact our "},{"type":"element","tag":"a","props":{"href":"https://docs.alokai.com/enterprise","rel":["nofollow"]},"children":[{"type":"text","value":"sales team"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://docs.alokai.com/storefront/integration-and-setup/overriding-api-methods","rel":["nofollow"]},"children":[{"type":"text","value":"Learn more about overriding API methods"}]}]},{"type":"element","tag":"card","props":{"icon":"tabler:number-6-small","title":"Next: Adding custom feature"},"children":[{"type":"element","tag":"template","props":{"v-slot:description":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Learn how to implement a custom feature by creating an extension."}]}]},{"type":"element","tag":"template","props":{"v-slot:cta":""},"children":[{"type":"element","tag":"docs-button","props":{"to":"/guides/customization-next-js/adding-extension"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":5,"depth":2,"links":[]}},"_type":"markdown","_id":"content:guides:4.customization-next-js:6.method-overriding.md","_source":"content","_file":"guides/4.customization-next-js/6.method-overriding.md","_extension":"md","sitemap":{"loc":"/guides/customization-next-js/method-overriding"}},"hash":"QTAbEKo0k6"}