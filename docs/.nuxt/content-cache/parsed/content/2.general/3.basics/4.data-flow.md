{"parsed":{"_path":"/general/basics/data-flow","_dir":"basics","_draft":false,"_partial":false,"_locale":"","title":"Data Flow","description":"The below document describes the data flow in the typical Alokai application using our SDK and Middleware.","layout":"default","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"data-flow"},"children":[{"type":"text","value":"Data Flow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The below document describes the data flow in the typical Alokai application using our SDK and Middleware."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On a high level, the data flow in Alokai is relatively simple and has only two major steps:"}]},{"type":"element","tag":"steps","props":{},"children":[{"type":"element","tag":"template","props":{"v-slot:step-1":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Storefront"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the Frontend layer, you call one of Alokai SDK methods (eg. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sdk.sapcc.getProducts()"}]},{"type":"text","value":" ). This method is being translated into a REST API Call to Alokai Middleware (eg  "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vsf.com/api/sapcc/getproducts"}]},{"type":"text","value":")."}]}]},{"type":"element","tag":"template","props":{"v-slot:step-2":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Middleware"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Alokai Middleware makes a REST call to the external API and returns the data retrieved from it."}]}]}]},{"type":"element","tag":"img","props":{"alt":"General Data Flow","src":"/2.general/3.basics/img/data-flow/general.svg","style":{"aspectRatio":"918/639"}},"children":[]},{"type":"element","tag":"h2","props":{"id":"storefront-data-flow"},"children":[{"type":"text","value":"Storefront Data Flow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the storefront we usually call a composable/hook (Vue/React) directly from a component. It’s responsible for binding the data returned by SDK with the framework-specific features like Vue.js reactivity system or state managment library."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Every composable/hook in our storefront under the hood uses SDK methods. SDK methods retrieve data from the Middleware. Before the method is called, it runs all registered “before” interceptors from SDK extension that can modify its parameters ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"args"}]},{"type":"text","value":"). In the same way, it checks for “after” interceptors that can modify the response ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"res"}]},{"type":"text","value":")."}]},{"type":"element","tag":"img","props":{"alt":"Storefront Data Flow","src":"/2.general/3.basics/img/data-flow/storefront.svg","className":["mx-auto"],"style":{"aspectRatio":"371/423"}},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At the very bottom of Storefront flow, an SDK method calls Alokai Middleware. Let’s see how the data flows there!"}]},{"type":"element","tag":"h2","props":{"id":"middleware-data-flow"},"children":[{"type":"text","value":"Middleware Data Flow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the Middleware side, each request is propagated to the API Client. The URL determines which API Client will be used. For example, calling "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/sapcc/getProduct"}]},{"type":"text","value":" endpoint will run "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"getProduct"}]},{"type":"text","value":" method from the SAP Commerce Cloud integration represented by "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sapcc"}]},{"type":"text","value":" tag in the middleware configuration file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each API Client and method exposes hooks that allow you to change the initial configuration of the integration, modify method arguments, change response, or just run other custom code."}]},{"type":"element","tag":"img","props":{"alt":"General Data Flow","src":"/2.general/3.basics/img/data-flow/middleware.svg","className":["mx-auto"],"style":{"aspectRatio":"426/467"}},"children":[]},{"type":"element","tag":"card","props":{"description":"Middleware is an integration and orchestration layer of Alokai stack. It connects different third-party vendors and exposes one API to the Storefront (or other touchpoints) to increase performance and scalability of your application.","icon":"fa6-solid:layer-group","title":"Middleware","to":"/middleware"},"children":[]},{"type":"element","tag":"h2","props":{"id":"using-graphql"},"children":[{"type":"text","value":"Using GraphQL"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You probably noticed that the protocol used to communicated with the middleware is REST protocol. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"It doesn't mean you can't use GraphQL"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Our Middleware can connect to any data source, no matter what protocol it's using. If an integration is using GraphQL API it already has default queries/mutations associated to certain methods stored on the middleware layer. You can pass custom ones directly from the frontend or keep them in the middleware layer to reduce payloads and shave few kB's from your frontend bundle."}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes one-dark-pro","code":"// in the frontend\nconst { search } = useProduct();\n\nsearch({\n  customQuery: {\n    products: 'my-products-query', // you can reference query on the middleware by string or just pass it directly\n    metadata: { size: 'xl' },\n  },\n});\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// in the frontend\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"search"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useProduct"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"search"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  customQuery"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    products"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'my-products-query'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// you can reference query on the middleware by string or just pass it directly\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    metadata"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"size"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'xl'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"});\n"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":5,"depth":2,"links":[{"id":"storefront-data-flow","depth":2,"text":"Storefront Data Flow"},{"id":"middleware-data-flow","depth":2,"text":"Middleware Data Flow"},{"id":"using-graphql","depth":2,"text":"Using GraphQL"}]}},"_type":"markdown","_id":"content:2.general:3.basics:4.data-flow.md","_source":"content","_file":"2.general/3.basics/4.data-flow.md","_extension":"md","sitemap":{"loc":"/general/basics/data-flow","images":[{"loc":"/img/data-flow/general.svg"},{"loc":"/img/data-flow/storefront.svg"},{"loc":"/img/data-flow/middleware.svg"}]}},"hash":"ksRiWPwbVK"}